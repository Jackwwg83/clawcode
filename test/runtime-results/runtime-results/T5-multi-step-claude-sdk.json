{
  "payloads": [
    {
      "text": "æˆ‘æ¥å¸®ä½ æŸ¥çœ‹ src/agents/ ç›®å½•ä¸‹çš„æ–‡ä»¶ç»“æ„ï¼Œå¹¶åˆ†æè¿™ä¸ªé¡¹ç›®çš„ agent æ¶æ„ã€‚è®©æˆ‘æŸ¥çœ‹ä¸€äº›å…³é”®æ–‡ä»¶æ¥ç†è§£æ¶æ„ï¼šè®©æˆ‘æŸ¥çœ‹æ›´å¤šå…³é”®æ–‡ä»¶æ¥ç†è§£æ•´ä½“æ¶æ„ï¼šç°åœ¨æˆ‘æ¥æŸ¥çœ‹é¡¹ç›®çš„æ•´ä½“æ¶æ„æè¿°æ–‡æ¡£ï¼šæ ¹æ®æˆ‘çš„åˆ†æï¼Œæˆ‘ç°åœ¨å¯ä»¥ä¸ºä½ è¯¦ç»†è§£é‡Šè¿™ä¸ªé¡¹ç›®çš„ agent æ¶æ„äº†ã€‚\n\n## ğŸ“Š ClawCode/OpenClaw çš„ Agent æ¶æ„åˆ†æ\n\n### **ç›®å½•ç»“æ„æ€»è§ˆ**\n\n```\nsrc/agents/\nâ”œâ”€â”€ æ ¸å¿ƒè¿è¡Œæ—¶\nâ”‚   â”œâ”€â”€ claude-sdk-runner/        # Claude Agent SDK è¿è¡Œæ—¶ï¼ˆClawCode v0.1 æ–°å¢ï¼‰\nâ”‚   â”œâ”€â”€ pi-embedded-runner/       # åŸç”ŸåµŒå…¥å¼ agent è¿è¡Œæ—¶\nâ”‚   â””â”€â”€ cli-runner/               # CLI è¿è¡Œæ—¶\nâ”‚\nâ”œâ”€â”€ Agent ç®¡ç†\nâ”‚   â”œâ”€â”€ agent-scope.ts            # Agent ä½œç”¨åŸŸå’Œé…ç½®ç®¡ç†\nâ”‚   â”œâ”€â”€ agent-paths.ts            # Agent è·¯å¾„è§£æ\nâ”‚   â””â”€â”€ context.ts                # Agent ä¸Šä¸‹æ–‡ç®¡ç†\nâ”‚\nâ”œâ”€â”€ å·¥å…·ç³»ç»Ÿ\nâ”‚   â”œâ”€â”€ tools/                    # æ ¸å¿ƒå·¥å…·é›†\nâ”‚   â”‚   â”œâ”€â”€ sessions-*.ts         # è·¨ session é€šä¿¡å·¥å…·\nâ”‚   â”‚   â”œâ”€â”€ message-tool.ts       # æ¶ˆæ¯å‘é€å·¥å…·\nâ”‚   â”‚   â”œâ”€â”€ memory-tool.ts        # è®°å¿†ç³»ç»Ÿ\nâ”‚   â”‚   â”œâ”€â”€ web-tools.ts          # Web æœç´¢/æŠ“å–\nâ”‚   â”‚   â”œâ”€â”€ browser-tool.ts       # æµè§ˆå™¨æ§åˆ¶\nâ”‚   â”‚   â”œâ”€â”€ image-tool.ts         # å›¾åƒç”Ÿæˆ\nâ”‚   â”‚   â”œâ”€â”€ canvas-tool.ts        # Canvas äº¤äº’\nâ”‚   â”‚   â”œâ”€â”€ discord-actions.ts    # Discord é›†æˆ\nâ”‚   â”‚   â”œâ”€â”€ slack-actions.ts      # Slack é›†æˆ\nâ”‚   â”‚   â”œâ”€â”€ telegram-actions.ts   # Telegram é›†æˆ\nâ”‚   â”‚   â””â”€â”€ ...æ›´å¤šé›†æˆå·¥å…·\nâ”‚   â”œâ”€â”€ bash-tools*.ts            # Bash æ‰§è¡Œå·¥å…·\nâ”‚   â””â”€â”€ openclaw-tools.ts         # å·¥å…·ç»„è£…å™¨\nâ”‚\nâ”œâ”€â”€ æ²™ç®±ç³»ç»Ÿ\nâ”‚   â””â”€â”€ sandbox/                  # Docker æ²™ç®±ç®¡ç†\nâ”‚       â”œâ”€â”€ config.ts             # æ²™ç®±é…ç½®\nâ”‚       â”œâ”€â”€ manage.ts             # å®¹å™¨ç®¡ç†\nâ”‚       â””â”€â”€ workspace.ts          # å·¥ä½œç©ºé—´æŒ‚è½½\nâ”‚\nâ”œâ”€â”€ è®¤è¯ç³»ç»Ÿ\nâ”‚   â””â”€â”€ auth-profiles/            # å¤šæ¨¡å‹è®¤è¯é…ç½®\nâ”‚       â”œâ”€â”€ oauth.ts              # OAuth æµç¨‹\nâ”‚       â”œâ”€â”€ order.ts              # Profile ä¼˜å…ˆçº§\nâ”‚       â””â”€â”€ store.ts              # è®¤è¯å­˜å‚¨\nâ”‚\nâ”œâ”€â”€ æ‰©å±•ç³»ç»Ÿ\nâ”‚   â””â”€â”€ pi-extensions/            # Agent æ‰©å±•\nâ”‚       â”œâ”€â”€ context-pruning/      # ä¸Šä¸‹æ–‡ä¿®å‰ª\nâ”‚       â””â”€â”€ compaction-safeguard.ts\nâ”‚\nâ””â”€â”€ Skills ç³»ç»Ÿ\n    â””â”€â”€ skills/                   # æŠ€èƒ½åŠ è½½å™¨\n        â”œâ”€â”€ plugin-skills.ts      # æ’ä»¶æŠ€èƒ½\n        â””â”€â”€ serialize.ts          # æŠ€èƒ½åºåˆ—åŒ–\n```\n\n---\n\n### **ğŸ¯ æ ¸å¿ƒæ¶æ„è®¾è®¡**\n\n#### **1. åŒè¿è¡Œæ—¶æ¶æ„ï¼ˆé‡è¦ï¼ï¼‰**\n\næ ¹æ® git commit å†å²ï¼Œè¿™ä¸ªé¡¹ç›®å®ç°äº†**åŒè¿è¡Œæ—¶å åŠ **ï¼š\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ClawCode v0.1 (Claude Agent SDK Layer) â”‚  â† æ–°å¢å±‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  OpenClaw (åŸç”Ÿ Pi-Embedded Runtime)     â”‚  â† åŸæœ‰åŸºç¡€\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**A. Claude SDK Runner** (`claude-sdk-runner/`)\n- **ç”¨é€”**: ä½¿ç”¨ Anthropic å®˜æ–¹çš„ Claude Agent SDK\n- **ç‰¹ç‚¹**: \n  - é€šè¿‡ `@anthropic-ai/claude-agent-sdk` çš„ `query()` API è¿è¡Œ\n  - æ”¯æŒå­è¿›ç¨‹ç®¡ç†å’Œå¼ºåˆ¶ç»ˆæ­¢ï¼ˆ`conversation.close()`ï¼‰\n  - å¤„ç†æµå¼å“åº”å’Œå·¥å…·è°ƒç”¨\n  - æ”¯æŒè¶…æ—¶å’Œ abort æœºåˆ¶\n\n**B. Pi-Embedded Runner** (`pi-embedded-runner/`)\n- **ç”¨é€”**: åŸç”Ÿå®ç°çš„ agent è¿è¡Œæ—¶\n- **ç‰¹ç‚¹**:\n  - ç›´æ¥è°ƒç”¨ LLM APIï¼ˆæ”¯æŒå¤šæä¾›å•†ï¼‰\n  - å®Œæ•´çš„ä¸Šä¸‹æ–‡ç®¡ç†å’Œå‹ç¼©\n  - å·¥å…·è°ƒç”¨å¾ªç¯æ§åˆ¶\n  - è‡ªå®šä¹‰æµå¼å¤„ç†\n\n---\n\n#### **2. Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†**\n\n```typescript\n// ä» agent-scope.ts çœ‹åˆ°çš„æ¶æ„\nAgent é…ç½®å±‚çº§:\n  config.json (agents.list[])\n    â†“\n  resolveAgentConfig(sessionKey)\n    â†“\n  {\n    id: string,              // agent å”¯ä¸€æ ‡è¯†\n    name: string,            // æ˜¾ç¤ºåç§°\n    workspace: string,       // å·¥ä½œç›®å½•\n    model: {...},            // æ¨¡å‹é…ç½®\n    skills: [],              // æŠ€èƒ½åˆ—è¡¨\n    sandbox: {...},          // æ²™ç®±é…ç½®\n    tools: {...},            // å·¥å…·ç­–ç•¥\n  }\n```\n\n**Session Key æ ¼å¼**: `agent:<agentId>:session:<sessionId>`\n- æ”¯æŒå¤š agent å®ä¾‹\n- æ¯ä¸ª agent å¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹ session\n- Session çŠ¶æ€æŒä¹…åŒ–åˆ° `~/.openclaw/agents/<agentId>/sessions/`\n\n---\n\n#### **3. å·¥å…·ç³»ç»Ÿæ¶æ„**\n\n**å·¥å…·ç»„è£…æµç¨‹** (`openclaw-tools.ts`):\n\n```typescript\ncreateOpenClawTools(options) â†’ AnyAgentTool[]\n  â”œâ”€ æ ¸å¿ƒå·¥å…· (æ€»æ˜¯å¯ç”¨)\n  â”‚   â”œâ”€ MessageTool        // å‘é€æ¶ˆæ¯åˆ°å„æ¸ é“\n  â”‚   â”œâ”€ SessionsSpawnTool  // ç”Ÿæˆå­ agent\n  â”‚   â”œâ”€ SessionsSendTool   // è·¨ session é€šä¿¡\n  â”‚   â””â”€ SessionsListTool   // åˆ—å‡ºæ´»åŠ¨ session\n  â”‚\n  â”œâ”€ å¢å¼ºå·¥å…· (å¯é€‰)\n  â”‚   â”œâ”€ WebSearchTool      // Web æœç´¢\n  â”‚   â”œâ”€ WebFetchTool       // Web æŠ“å–\n  â”‚   â”œâ”€ ImageTool          // å›¾åƒç”Ÿæˆ\n  â”‚   â”œâ”€ BrowserTool        // æµè§ˆå™¨æ§åˆ¶\n  â”‚   â”œâ”€ CanvasTool         // Canvas æ¸²æŸ“\n  â”‚   â””â”€ TtsTool            // æ–‡å­—è½¬è¯­éŸ³\n  â”‚\n  â””â”€ é›†æˆå·¥å…· (æŒ‰é…ç½®)\n      â”œâ”€ DiscordActions     // Discord æ“ä½œ\n      â”œâ”€ SlackActions       // Slack æ“ä½œ\n      â”œâ”€ TelegramActions    // Telegram æ“ä½œ\n      â””â”€ plugin tools...    // æ’ä»¶å·¥å…·\n```\n\n**å·¥å…·ç­–ç•¥æ§åˆ¶** (`pi-tools.policy.ts`):\n- æ”¯æŒæŒ‰ agent/channel/group ç²’åº¦æ§åˆ¶å·¥å…·å¯ç”¨æ€§\n- æ”¯æŒæ²™ç®±æ¨¡å¼ä¸‹çš„å·¥å…·é™åˆ¶\n- æ”¯æŒå·¥å…·ç™½åå•/é»‘åå•\n\n---\n\n#### **4. æ²™ç®±ç³»ç»Ÿ**\n\n**Docker å®¹å™¨æ¶æ„** (`sandbox/`):\n\n```\nå®¿ä¸»æœº\n  â”œâ”€ ~/.openclaw/\n  â”‚   â””â”€ agents/<agentId>/\n  â”‚       â”œâ”€ workspace/          â† æŒ‚è½½åˆ°å®¹å™¨\n  â”‚       â””â”€ sessions/\n  â”‚\n  â””â”€ Docker Container (openclaw-sandbox)\n      â”œâ”€ /workspace/             â† RW æŒ‚è½½\n      â”œâ”€ Browser (Chromium)      â† é€šè¿‡ bridge æ§åˆ¶\n      â””â”€ noVNC                   â† è¿œç¨‹æ¡Œé¢è®¿é—®\n```\n\n**å®‰å…¨éš”ç¦»**:\n- æ–‡ä»¶ç³»ç»Ÿ: åªèƒ½è®¿é—®æŒ‚è½½çš„ workspace\n- ç½‘ç»œ: å¯é€‰éš”ç¦»æ¨¡å¼\n- è¿›ç¨‹: å®¹å™¨å†…å—é™æ‰§è¡Œ\n\n---\n\n#### **5. è·¨ Agent é€šä¿¡**\n\n**Sessions å·¥å…·æ—**:\n\n```typescript\n// Agent A ç”Ÿæˆå­ Agent B\nSessionsSpawnTool({\n  agentId: \"code-reviewer\",\n  message: \"Review this PR\",\n  inheritContext: true\n})\n\n// Agent A å‘é€æ¶ˆæ¯ç»™ Agent B\nSessionsSendTool({\n  to: \"agent:code-reviewer:session:abc123\",\n  message: \"Additional context...\",\n  waitForReply: true\n})\n\n// Agent B å›å¤\n// è‡ªåŠ¨è·¯ç”±å› Agent A çš„å¯¹è¯\n```\n\n---\n\n#### **6. è®¤è¯ç³»ç»Ÿï¼ˆAuth Profilesï¼‰**\n\n**å¤šæ¨¡å‹è®¤è¯ç®¡ç†** (`auth-profiles/`):\n\n```typescript\nè®¤è¯é…ç½®:\n  {\n    profiles: [\n      { id: \"anthropic-oauth-1\", provider: \"anthropic\", type: \"oauth\" },\n      { id: \"openai-key-1\", provider: \"openai\", type: \"api_key\" },\n      { id: \"google-oauth-1\", provider: \"google\", type: \"oauth\" }\n    ],\n    order: [\"anthropic-oauth-1\", \"openai-key-1\"],  // ä¼˜å…ˆçº§\n    failover: true                                  // è‡ªåŠ¨åˆ‡æ¢\n  }\n```\n\n**ç‰¹æ€§**:\n- OAuth å’Œ API Key æ··åˆæ”¯æŒ\n- è‡ªåŠ¨ failoverï¼ˆè®¤è¯å¤±è´¥/é™æµ/ä½™é¢ä¸è¶³ï¼‰\n- Cooldown æœºåˆ¶ï¼ˆå¤±è´¥åæš‚æ—¶è·³è¿‡ï¼‰\n- ä½¿ç”¨ç»Ÿè®¡è¿½è¸ª\n\n---\n\n#### **7. Context ç®¡ç†**\n\n**Context Pruning Extension** (`pi-extensions/context-pruning/`):\n\n```typescript\nä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥:\n  1. æ£€æµ‹ä¸Šä¸‹æ–‡æ¥è¿‘é™åˆ¶ (CONTEXT_WINDOW_WARN_BELOW_TOKENS)\n  2. è§¦å‘å‹ç¼© (compactEmbeddedPiSession)\n     â”œâ”€ ä¿ç•™ç³»ç»Ÿ prompt\n     â”œâ”€ ä¿ç•™æœ€è¿‘ N è½®å¯¹è¯\n     â””â”€ å‹ç¼©å†å²å¯¹è¯ä¸ºæ‘˜è¦\n  3. å¦‚æœä»è¶…é™ â†’ FailoverError\n```\n\n---\n\n### **ğŸ”„ å…¸å‹è¯·æ±‚æµç¨‹**\n\n```\nç”¨æˆ·æ¶ˆæ¯ (WhatsApp/Telegram/...)\n  â†“\nGateway æ¥æ”¶\n  â†“\nè·¯ç”±åˆ° Agent Session (agent-scope.ts)\n  â†“\né€‰æ‹©è¿è¡Œæ—¶:\n  â”œâ”€ runClaudeSdkAgent()       â† Claude SDK\n  â””â”€ runEmbeddedPiAgent()      â† åŸç”Ÿå®ç°\n      â†“\nåŠ è½½å·¥å…· (openclaw-tools.ts)\n  â†“\nè®¤è¯é€‰æ‹© (auth-profiles/)\n  â†“\næ‰§è¡Œ LLM è°ƒç”¨\n  â”œâ”€ æµå¼å¤„ç†å·¥å…·è°ƒç”¨\n  â”œâ”€ æ‰§è¡Œ Bash/Web/Message å·¥å…·\n  â””â”€ æ£€æŸ¥ä¸Šä¸‹æ–‡é™åˆ¶\n      â†“\nè¿”å›å“åº”\n  â†“\nå‘é€å›ç”¨æˆ·æ¸ é“\n```\n\n---\n\n### **ğŸ¨ æ¶æ„äº®ç‚¹**\n\n1. **åŒè¿è¡Œæ—¶è®¾è®¡**: æ—¢å¯ç”¨å®˜æ–¹ SDKï¼Œä¹Ÿå¯ç”¨è‡ªå®šä¹‰å®ç°\n2. **å·¥å…·ç³»ç»Ÿè§£è€¦**: å·¥å…·å®šä¹‰ä¸æ‰§è¡Œåˆ†ç¦»ï¼Œæ˜“æ‰©å±•\n3. **å¤š Agent å¹¶å‘**: æ”¯æŒä¸» agent ç”Ÿæˆå­ agentï¼ˆç±»ä¼¼ LangGraph çš„ supervisor æ¨¡å¼ï¼‰\n4. **æ²™ç®±å®‰å…¨**: Docker éš”ç¦» + å·¥å…·ç­–ç•¥åŒé‡ä¿æŠ¤\n5. **è·¨æ¸ é“ç»Ÿä¸€**: æŠ½è±¡äº† WhatsApp/Telegram/Discord ç­‰å·®å¼‚\n6. **è®¤è¯å¼¹æ€§**: è‡ªåŠ¨ failover ä¿è¯æœåŠ¡è¿ç»­æ€§\n\n---\n\n### **ğŸ’¡ æ€»ç»“**\n\nè¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§çš„ä¸ªäºº AI åŠ©æ‰‹æ¡†æ¶**ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š\n\n- **è¿è¡Œæ—¶**: åŒè¿è¡Œæ—¶æ¶æ„ï¼ˆSDK + è‡ªç ”ï¼‰\n- **å·¥å…·**: æ¨¡å—åŒ–ã€å¯é…ç½®ã€å¤šæ¸ é“é›†æˆ\n- **å®‰å…¨**: Docker æ²™ç®± + ç»†ç²’åº¦æƒé™æ§åˆ¶\n- **å¯é æ€§**: å¤šæ¨¡å‹ failover + ä¸Šä¸‹æ–‡ç®¡ç†\n- **æ‰©å±•æ€§**: Skills + Plugins + Extensions\n\nç›¸æ¯”ä¼ ç»Ÿçš„ chatbotï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ª**å¯ç¼–ç¨‹çš„ AI æ“ä½œç³»ç»Ÿ**ï¼Œå¯ä»¥è®¿é—®ä½ çš„æ¶ˆæ¯ã€æ–‡ä»¶ã€æµè§ˆå™¨ã€ç”šè‡³æ§åˆ¶æ™ºèƒ½å®¶å±…è®¾å¤‡ã€‚",
      "mediaUrl": null
    }
  ],
  "meta": {
    "durationMs": 100021,
    "agentMeta": {
      "sessionId": "compare-T5-multi-step-claude-sdk-1771229235",
      "provider": "anthropic",
      "model": "claude-sonnet-4-5-20250929",
      "usage": {
        "input": 1014,
        "output": 4836,
        "cacheRead": 238243,
        "cacheWrite": 19251,
        "total": 5850
      },
      "lastCallUsage": {
        "input": 1014,
        "output": 4836,
        "cacheRead": 238243,
        "cacheWrite": 19251,
        "total": 5850
      },
      "promptTokens": 1014
    }
  }
}
